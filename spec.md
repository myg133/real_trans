这是一份为您定制的**实时同声翻译应用（Real-time Speech Translation, RST）**技术规格说明书（Spec Coding Specification）。该方案专注于**本地化、低延时、跨平台**的核心需求。

---

## 1. 系统架构设计 (System Architecture)

系统采用**生产者-消费者（Producer-Consumer）**模型，通过高性能环形缓冲区（Ring Buffer）处理音频流，确保 UI 线程与推理线程解耦。

### 1.1 逻辑分层

* **接入层 (IO Layer):** 负责多系统的麦克风权限调用、音频采样（16kHz, Mono, PCM16）。
* **引擎层 (Engine Layer):** 封装 C++ 编写的 ASR、MT、TTS 核心库。
* **调度层 (Orchestrator):** 处理流式上下文（Context）管理、翻译修正逻辑（Rewriting Strategy）。
* **表示层 (UI Layer):** 跨平台前端，负责波形显示、双语文本滚动更新。

---

## 2. 核心组件规格 (Component Specs)

### 2.1 ASR 模块 (语音识别)

* **模型选型:** `Whisper-Tiny` (用于极低延迟) 或 `Distil-Whisper-Small` (平衡准确率)。
* **实现库:** `whisper.cpp` (C++ 集成)。
* **策略:** 
* **VAD (Voice Activity Detection):** 使用 Silero VAD 过滤静音，减少无效推理。
* **流式输出:** 每 200ms 抛出 Partial Result，每 1s 或检测到停顿时锁定 Final Result。

### 2.2 MT 模块 (机器翻译)

* **模型选型:** `Qwen2.5-0.5B` 或 `Llama-3.2-1B` (量化为 4-bit GGUF)。
* **实现库:** `llama.cpp`。
* **微调规范:** 
* **Prompt:** `Translate the following spoken Chinese to English concisely: [Input]`
* **上下文:** 保留前 3 轮翻译历史作为 KV Cache，确保代词（他/她/它）转换准确。

### 2.3 TTS 模块 (语音合成 - 可选)

* **模型选型:** `ChatTTS` (流式版本)。
* **策略:** ASR 确定 Final Result 后立即触发，采用流式音频块播放，避免等待完整音频生成。

---

## 3. 关键性能指标 (KPI)

| 指标 | 目标值 | 备注 |
| --- | --- | --- |
| **首字延时 (Initial Latency)** | < 800ms | 从说话到屏幕出现第一个词 |
| **内存占用 (Memory)** | < 1.2GB | 包含 ASR 和 MT 模型常驻 |
| **CPU 占用** | < 20% | 在 M1/M2 或 Intel i7 移动端基准测试 |
| **断句准确率** | > 90% | 依赖 VAD 和 ASR 的标点预测功能 |

---

## 4. 开发规范 (Development Standards)

### 4.1 代码组织

* **核心逻辑跨平台:** 所有推理逻辑必须用 **Rust** 编写，通过 **FFI (Foreign Function Interface)** 供各平台调用。
* **并发模型:** 
* 音频采集：高优先级线程。
* 模型推理：工作线程池，禁止阻塞 UI。

### 4.2 数据格式规范

* **音频采样率:** 统一强制为 `16,000Hz`（模型输入标准）。
* **文本传输:** 使用 **JSON 序列化流**，包含 `is_final` 布尔值，用于区分"中间预览文字"和"最终确定文字"。

### 4.3 错误处理

* **模型回退:** 如果本地 GPU 不可用，自动降级为 CPU 推理。
* **缓冲区溢出:** 当推理速度跟不上语速时，采用"跳帧"策略，优先处理最新的音频片段。

---

## 5. 本地化安装包方案

* **Windows:** 使用 `Inno Setup` 封装，包含 NVIDIA/DirectCompute 驱动检测。
* **macOS:** 封装为 `.app`，利用 **Metal API** 加速，支持 Apple Silicon 原生运行。
* **Linux:** 提供 `AppImage` 或 `Docker` 镜像。
* **模型分发:** 初始安装只带 Tiny ASR，用户首次运行时按需下载 0.6B 翻译模型（托管在 HF 镜像站）。

---

## 6. 待明确的技术细节 (Technical Clarifications Needed)

### 6.1 硬件要求和性能边界
* **最低硬件配置:** 明确CPU、内存、存储空间的最低要求
* **性能分级策略:** 定义在不同硬件等级下的性能预期和降级方案
* **GPU加速兼容性:** 详细说明NVIDIA CUDA、AMD ROCm、Apple Metal、Intel oneDNN等不同加速后端的兼容性要求

### 6.2 模型部署与管理
* **模型下载机制:** 实现断点续传、校验、缓存管理等功能
* **模型版本管理:** 定义模型版本控制、热更新、回滚策略
* **存储空间管理:** 实现模型清理、卸载、按需加载等功能

### 6.3 跨平台UI实现
* **技术栈选择:** 确定UI框架（如Flutter、Qt、Electron等）
* **平台适配:** 明确各平台（Windows/macOS/Linux/iOS/Android）的UI/UX差异处理
* **性能优化:** 定义UI渲染优化策略，确保流畅体验

### 6.4 音频处理细节
* **VAD与ASR协同:** 详细定义VAD检测结果与ASR模块的数据传递协议
* **噪音处理:** 明确背景噪音过滤、多人说话分离等复杂场景的处理策略
* **音频质量调节:** 定义自适应音频增益、回声消除等功能

### 6.5 错误恢复与用户体验
* **模块故障处理:** 定义ASR/MT/TTS任一模块失效时的降级策略
* **错误提示机制:** 设计用户友好的错误提示和恢复引导
* **异常状态恢复:** 实现从各种异常状态自动恢复的能力

### 6.6 国际化和语言支持
* **多语言扩展:** 规划除中英外其他语言对的扩展能力
* **语言检测:** 实现自动语言检测功能
* **区域化适配:** 考虑不同地区的语音特点和文化差异

### 6.7 测试策略
* **单元测试:** 定义各模块的测试覆盖要求
* **集成测试:** 建立端到端的翻译流程测试方案
* **性能测试:** 制定延时、吞吐量、稳定性等指标的测试方法
* **兼容性测试:** 明确在不同操作系统、硬件配置下的测试计划

---

## 7. 项目实施计划 (Implementation Roadmap)

### 7.1 第一阶段：Rust基础架构搭建
* 搭建Rust核心库框架
* 实现基本的环形缓冲区数据结构
* 集成音频采集功能
* 搭建Cargo构建系统

### 7.2 第二阶段：核心算法集成
* 集成rust-whisper或whisper-rs进行语音识别
* 集成llm或相关crate进行机器翻译
* 实现VAD语音活动检测
* 实现基础的流式处理管道

### 7.3 第三阶段：系统优化
* 性能优化和内存管理
* 实现GPU加速支持
* 优化延时和吞吐量
* 完善错误处理机制

### 7.4 第四阶段：UI界面开发
* 开发跨平台用户界面（可能使用Tauri或Iced）
* 实现实时波形显示
* 添加双语文本展示
* 集成交互控制功能

### 7.5 第五阶段：测试与发布
* 全面功能测试
* 性能基准测试
* 用户体验优化
* 打包发布各平台安装包